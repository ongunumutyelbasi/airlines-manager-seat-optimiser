<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Airlines Manager Dynamic Seat Optimiser</title>
    
    <!-- Tailwind CSS --><script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons --><script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Google Fonts: Rajdhani for that futuristic HUD look --><link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;600;700&display=swap" rel="stylesheet">

    <style>
        /* Typography Override */
        body {
            font-family: 'Rajdhani', sans-serif;
        }

        /* Chrome, Safari, Edge, Opera */
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
        }

        /* Firefox */
        input[type=number] {
        -moz-appearance: textfield;
        }

        /* Background Pattern */
        .bg-grid-pattern {
            /* The base background color is set by Tailwind bg-[#050508] in the body tag */
            background: 
                linear-gradient(to right, #ffffff10 1px, transparent 1px) 0 0,
                linear-gradient(to bottom, #ffffff10 1px, transparent 1px) 0 0;
            background-size: 20px 20px;
            background-repeat: repeat; /* Explicitly set repeat */
        }
        
        /* The body class still needs to manage the background color */
        body.bg-grid-pattern {
            background-color: #050508;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }
        ::-webkit-scrollbar-track {
            background: #0f172a; 
        }
        ::-webkit-scrollbar-thumb {
            background: #22d3ee;
            border-radius: 3px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #67e8f9;
        }

        /* Toggle Switch */
        .toggle-checkbox {
            position: absolute;
            left: 0;
            margin: 0;
            padding: 0;
            opacity: 0; /* Hide native checkbox */
        }
        .toggle-label {
            position: relative;
            display: block;
            width: 40px;
            height: 20px;
            border-radius: 10px;
            background-color: #334155;
            cursor: pointer;
            transition: all 0.3s;
        }
        .toggle-label::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background-color: white;
            transition: all 0.3s;
        }
        .toggle-checkbox:checked + .toggle-label {
            background-color: #22d3ee;
            box-shadow: 0 0 8px rgba(34, 211, 238, 0.4);
        }
        .toggle-checkbox:checked + .toggle-label::after {
            transform: translateX(20px);
        }

        /* Disabled Input Styling */
        input:disabled {
            background-color: transparent;
            border-color: transparent;
            color: #64748b;
            cursor: not-allowed;
            padding-left: 0;
            text-align: right;
        }

        /* Neon Glow Effects */
        .glow-text {
            text-shadow: 0 0 3px rgba(34, 211, 238, 0.3);
        }
        .glow-border:focus-within {
            box-shadow: 0 0 10px rgba(34, 211, 238, 0.15);
            border-color: #22d3ee;
        }
        
        /* Table Styling Overrides: Remove vertical borders (dividers) */
        th, td {
            border-right: none !important; /* Forces removal of Tailwind's border-r classes */
        }
        thead th {
            border-left: none !important;
            border-right: none !important;
        }

        /* Utility for animation/transition */
        .fade-in {
            opacity: 1;
            max-height: 500px;
            transition: opacity 0.3s ease-in, max-height 0.5s ease-in;
        }
        .fade-out {
            opacity: 0;
            max-height: 0;
            overflow: hidden;
            transition: opacity 0.3s ease-out, max-height 0.5s ease-out;
        }

    </style>
</head>
<body class="bg-[#050508] text-slate-300 min-h-screen selection:bg-cyan-500/20 selection:text-cyan-200 bg-grid-pattern relative overflow-x-hidden">

    <!-- Ambient Light Effect --><div class="fixed top-0 left-1/2 -translate-x-1/2 w-[700px] h-[350px] bg-cyan-900/5 rounded-full blur-[100px] -z-10 pointer-events-none"></div>

    <!-- Main Container --><div class="max-w-7xl mx-auto p-4 md:p-6">
        
        <header class="mb-6 flex items-center justify-between border-b border-white/10 pb-4">
            <div class="flex items-center gap-3">
                <div class="p-2.5 bg-cyan-950/20 border border-cyan-500/20 rounded-lg shadow-[0_0_10px_rgba(34,211,238,0.1)]">
                    <i data-lucide="plane" class="w-6 h-6 text-cyan-300"></i>
                </div>
                <div>
                    <h1 class="text-3xl font-bold text-white tracking-wide glow-text uppercase">Reverse Seat Optimiser</h1>
                    <p class="text-slate-600 text-xs font-semibold tracking-widest uppercase">AM Tycoon // Configuration Assistant // Made by <a href="https://su-consultancy.com" target="_blank" rel="noopener noreferrer" class="hover:underline hover:text-cyan-500 hover:transition hover:duration-300">Umut Yelbaşı</a></p>
                </div>
            </div>

            <nav class="pt-4 mt-2"> <!-- Removed border-t -->
                <ul class="flex space-x-8 text-base font-semibold">
                    <li>
                        <a href="reverse-optimizer.html" class="text-slate-500 hover:text-cyan-400 hover:border-b-2 hover:border-cyan-700 pb-0.5 transition duration-200">
                            SEAT OPTIMISER
                        </a>
                    </li>
                    <li>
                        <!-- Placeholder Link: Reduced bottom padding for sleeker hover -->
                        <a href="#" class="text-slate-500 hover:text-cyan-400 hover:border-b-2 hover:border-cyan-700 pb-0.5 transition duration-200">
                            REVERSE OPTIMISER
                        </a>
                    </li>
                    <li>
                        <!-- Placeholder Link: Reduced bottom padding for sleeker hover -->
                        <a href="#" class="text-slate-500 hover:text-cyan-400 hover:border-b-2 hover:border-cyan-700 pb-0.5 transition duration-200">
                            R&D TRACKER
                        </a>
                    </li>
                </ul>
            </nav>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-4">
            
            <!-- LEFT COLUMN: Inputs --><div class="lg:col-span-4 space-y-4">
                
                <!-- 1. Aircraft Selection Card --><div class="bg-[#0f1014]/80 backdrop-blur-md border border-white/10 rounded-xl p-4 shadow-lg relative z-30 glow-border transition-colors duration-300">
                    <h2 class="text-sm font-bold text-cyan-300 mb-3 flex items-center gap-2 uppercase tracking-wider">
                        <i data-lucide="search" class="w-4 h-4"></i> Aircraft Selection
                    </h2>
                    
                    <div class="relative">
                        <!-- Clickable Selector --><div 
                            id="planeSelector"
                            class="w-full bg-black/40 border border-white/10 rounded px-3 py-2.5 text-white cursor-pointer hover:border-cyan-500/30 hover:bg-cyan-950/5 transition-all flex justify-between items-center group"
                        >
                            <span id="selectedPlaneName" class="truncate font-semibold text-sm">Select Aircraft...</span>
                            <i data-lucide="chevron-down" class="w-4 h-4 text-slate-500 group-hover:text-cyan-300 transition-colors"></i>
                        </div>

                        <!-- Dropdown with Search Inside --><div 
                            id="planeDropdown" 
                            class="absolute z-50 left-0 right-0 mt-1 bg-[#1a1b21] border border-cyan-500/20 rounded shadow-[0_10px_30px_-10px_rgba(0,0,0,0.6)] hidden overflow-hidden"
                        >
                            <div class="p-2 border-b border-white/5 bg-[#1a1b21] sticky top-0">
                                <input 
                                    type="text" 
                                    id="planeSearch" 
                                    placeholder="FILTER MODELS..." 
                                    class="w-full bg-black/50 border border-white/10 rounded px-3 py-1.5 text-sm text-cyan-200 placeholder-slate-600 focus:border-cyan-400 focus:outline-none uppercase tracking-wide"
                                >
                            </div>
                            <div id="planeList" class="max-h-60 overflow-y-auto">
                                <!-- Options injected by JS --></div>
                        </div>
                    </div>

                    <!-- Stats / Custom Inputs --><div id="selectedPlaneStats" class="mt-3 pt-3 border-t border-white/5 space-y-2">
                        <div class="flex justify-between items-center">
                            <span class="text-slate-600 text-xs font-bold uppercase tracking-wider">Max Capacity (Seats)</span>
                            <input type="number" id="inputCapacity" value="300" class="bg-transparent border-b border-white/10 hover:border-cyan-500/30 focus:border-cyan-400 px-0 py-0.5 text-white text-right w-24 outline-none font-mono text-sm transition-colors">
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-slate-600 text-xs font-bold uppercase tracking-wider">Max Payload (Tonnes)</span>
                            <div class="relative">
                                <input type="number" id="inputPayload" step="0.1" value="60.00" class="bg-transparent border-b border-white/10 hover:border-cyan-500/30 focus:border-cyan-400 px-0 py-0.5 text-white text-right w-24 outline-none font-mono text-sm transition-colors">
                            </div>
                        </div>
                        <div id="customHint" class="text-[10px] text-cyan-400 pt-2 text-right font-semibold tracking-wide">
                            // Using default custom values
                        </div>
                    </div>
                </div>

                <!-- 2. Route Demand Card --><div class="bg-[#0f1014]/80 backdrop-blur-md border border-white/10 rounded-xl p-4 shadow-lg glow-border">
                    <h2 class="text-sm font-bold text-cyan-300 mb-3 flex items-center gap-2 uppercase tracking-wider">
                        <i data-lucide="users" class="w-4 h-4"></i> Route Demand (24H - Return Trip)
                    </h2>
                    <!-- Single Row for all 4 inputs --><div class="grid grid-cols-4 gap-2">
                        <!-- Economy --><div class="group">
                            <label class="block text-[10px] font-bold text-slate-600 mb-1 text-center uppercase group-hover:text-cyan-500 transition-colors">Economy</label>
                            <input type="number" id="demandEco" value="0" class="w-full bg-black/40 border border-white/10 rounded px-1 py-2 text-white text-center focus:border-cyan-400 outline-none transition-all font-mono text-sm hover:bg-cyan-950/5">
                        </div>
                        <!-- Business --><div class="group">
                            <label class="block text-[10px] font-bold text-slate-600 mb-1 text-center uppercase group-hover:text-emerald-500 transition-colors">Business</label>
                            <input type="number" id="demandBus" value="0" class="w-full bg-black/40 border border-white/10 rounded px-1 py-2 text-white text-center focus:border-emerald-400 outline-none transition-all font-mono text-sm hover:bg-emerald-950/5">
                        </div>
                        <!-- First --><div class="group">
                            <label class="block text-[10px] font-bold text-slate-600 mb-1 text-center uppercase group-hover:text-purple-500 transition-colors">First</label>
                            <input type="number" id="demandFirst" value="0" class="w-full bg-black/40 border border-white/10 rounded px-1 py-2 text-white text-center focus:border-purple-400 outline-none transition-all font-mono text-sm hover:bg-purple-950/5">
                        </div>
                        <!-- Cargo --><div class="group">
                            <label class="block text-[10px] font-bold text-slate-600 mb-1 text-center uppercase group-hover:text-amber-500 transition-colors">Cargo (Tonnes RT)</label>
                            <input type="number" id="demandCargo" value="0" step="0.1" class="w-full bg-black/40 border border-white/10 rounded px-1 py-2 text-white text-center focus:border-amber-400 outline-none transition-all font-mono text-sm hover:bg-amber-950/5">
                        </div>
                    </div>
                </div>

                <!-- 3. Flight Duration Card -->
                <div class="bg-[#0f1014]/80 backdrop-blur-md border border-white/10 rounded-xl shadow-lg relative z-20 overflow-hidden glow-border">
                    
                    <!-- Header with Toggle -->
                    <div class="p-4 flex justify-between items-center border-b border-white/5">
                        <h2 class="text-sm font-bold text-cyan-300 flex items-center gap-2 uppercase tracking-wider">
                            <i data-lucide="clock" class="w-4 h-4"></i> Flight Duration
                        </h2>
                        <div class="flex items-center gap-2">
                            <span class="text-[10px] text-slate-500 uppercase font-semibold">Limit flights by duration</span>
                            <input type="checkbox" id="durationToggle" class="toggle-checkbox" checked>
                            <label for="durationToggle" class="toggle-label"></label>
                        </div>
                    </div>
                    
                    <!-- Content (Inputs - Hidden when toggle is off) -->
                    <div id="durationContent" class="fade-in">
                        <div class="p-4 border-b border-white/5">
                            <div class="grid grid-cols-2 gap-3">
                                <div>
                                    <label class="block text-[10px] font-bold text-slate-600 mb-1 uppercase">Hours</label>
                                    <div class="relative">
                                        <select id="hoursInput" class="w-full bg-black/40 border border-white/10 rounded px-3 py-2 text-white focus:border-cyan-400 outline-none appearance-none text-sm font-mono">
                                            <!-- JS will populate 1-24 --></select>
                                        <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-slate-500">
                                            <i data-lucide="chevron-down" class="w-3 h-3"></i>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-[10px] font-bold text-slate-600 mb-1 uppercase">Minutes</label>
                                    <div class="relative">
                                        <select id="minutesInput" class="w-full bg-black/40 border border-white/10 rounded px-3 py-2 text-white focus:border-cyan-400 outline-none appearance-none text-sm font-mono">
                                            <option value="0">00</option>
                                            <option value="15">15</option>
                                            <option value="30">30</option>
                                            <option value="45">45</option>
                                        </select>
                                        <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-slate-500">
                                            <i data-lucide="chevron-down" class="w-3 h-3"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Calculation Summary (Hidden when toggle is off) -->
                    <div id="durationSummary" class="fade-in text-xs font-semibold space-y-2 bg-black/40">
                        <div class="p-4">
                            <!-- Summary injected by JS -->
                        </div>
                    </div>
                </div>

            </div>

            <!-- RIGHT COLUMN: Results --><div class="lg:col-span-8">
                
                <!-- Table --><div class="bg-[#0f1014]/90 border border-white/10 rounded-xl overflow-hidden shadow-[0_0_30px_-10px_rgba(0,0,0,0.5)] flex flex-col h-full">
                    <div class="overflow-x-auto flex-1">
                        <table class="w-full text-center border-collapse">
                            <thead>
                                <tr class="bg-black/40 text-slate-600 text-[10px] uppercase tracking-widest border-b border-white/5 sticky top-0">
                                    <th class="p-3 font-bold min-w-[50px] text-cyan-400">Waves (Legs)</th>
                                    <th class="p-3 font-bold text-cyan-500">Economy</th>
                                    <th class="p-3 font-bold text-emerald-500">Business</th>
                                    <th class="p-3 font-bold text-purple-500">First</th>
                                    <th class="p-3 font-bold text-amber-500">Cargo (t)</th>
                                    <th class="p-3 font-bold text-red-400 min-w-[100px]">Payload (tonnes)</th>
                                    <th class="p-3 font-bold text-red-400 min-w-[100px]">Capacity (seats)</th>
                                    <th class="p-3 font-bold text-green-400">Valid?</th>
                                </tr>
                            </thead>
                            <tbody class="text-sm font-mono text-slate-300 divide-y divide-white/5" id="resultsBody">
                                <!-- Rows generated by JS --></tbody>
                        </table>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- LOGIC SCRIPT (Full and complete) --><script>
        // --- CONSTANTS ---
        const PLANES_DB = [
            { model: 'Custom Aircraft (Enter Below)', maxCapacity: 0, maxPayload: 0 },
            { model: 'Aérospatiale Caravelle 12', maxCapacity: 130, maxPayload: 13.0 },
            { model: 'Aérospatiale Concorde', maxCapacity: 128, maxPayload: 12.8 },
            { model: 'Airbus A220-100', maxCapacity: 135, maxPayload: 15.1 },
            { model: 'Airbus A220-300', maxCapacity: 160, maxPayload: 18.71 },
            { model: 'Airbus A300-600R', maxCapacity: 360, maxPayload: 36.0 },
            { model: 'Airbus A310-300', maxCapacity: 275, maxPayload: 27.5 },
            { model: 'Airbus A318-100', maxCapacity: 136, maxPayload: 13.6 },
            { model: 'Airbus A319-100', maxCapacity: 160, maxPayload: 16.00 },
            { model: 'Airbus A319-100LR', maxCapacity: 160, maxPayload: 16.00 },
            { model: 'Airbus A319neo', maxCapacity: 160, maxPayload: 16.00 },
            { model: 'Airbus A320-200', maxCapacity: 180, maxPayload: 18.29 },
            { model: 'Airbus A320neo', maxCapacity: 195, maxPayload: 19.65 },
            { model: 'Airbus A321-200', maxCapacity: 220, maxPayload: 22.0 },
            { model: 'Airbus A321XLR', maxCapacity: 244, maxPayload: 24.4 },
            { model: 'Airbus A321neo', maxCapacity: 244, maxPayload: 24.4 },
            { model: 'Airbus A321neo-LR', maxCapacity: 244, maxPayload: 24.9 },
            { model: 'Airbus A330-200', maxCapacity: 406, maxPayload: 40.59 },
            { model: 'Airbus A330-300', maxCapacity: 440, maxPayload: 56.0 },
            { model: 'Airbus A330-800', maxCapacity: 406, maxPayload: 46.0 },
            { model: 'Airbus A330-900', maxCapacity: 460, maxPayload: 46.0 },
            { model: 'Airbus A340-200', maxCapacity: 420, maxPayload: 43.5 },
            { model: 'Airbus A340-300', maxCapacity: 440, maxPayload: 44.0 },
            { model: 'Airbus A340-500', maxCapacity: 475, maxPayload: 47.5 },
            { model: 'Airbus A340-600', maxCapacity: 530, maxPayload: 55.6 },
            { model: 'Airbus A350-1000', maxCapacity: 522, maxPayload: 56.1 },
            { model: 'Airbus A350-900ULR', maxCapacity: 440, maxPayload: 44.0 },
            { model: 'Airbus A350-900XWB', maxCapacity: 475, maxPayload: 48.0 },
            { model: 'Airbus A380-800', maxCapacity: 853, maxPayload: 89.2 },
            { model: 'ATR 42-500', maxCapacity: 50, maxPayload: 5.4 },
            { model: 'ATR 42-600', maxCapacity: 50, maxPayload: 5.9 },
            { model: 'ATR 72-500', maxCapacity: 74, maxPayload: 7.5 },
            { model: 'ATR 72-600', maxCapacity: 74, maxPayload: 8.0 },
            { model: 'Bae Systems Jetstream-41', maxCapacity: 30, maxPayload: 3.5 },
            { model: 'Bae Systems RJ-85', maxCapacity: 118, maxPayload: 11.8 },
            { model: 'Boeing 707-320C', maxCapacity: 219, maxPayload: 34.0 },
            { model: 'Boeing 717-200', maxCapacity: 134, maxPayload: 14.5 },
            { model: 'Boeing 737-200', maxCapacity: 136, maxPayload: 14.0 },
            { model: 'Boeing 737-300', maxCapacity: 149, maxPayload: 16.1 },
            { model: 'Boeing 737-400', maxCapacity: 189, maxPayload: 19.9 },
            { model: 'Boeing 737-500', maxCapacity: 132, maxPayload: 15.2 },
            { model: 'Boeing 737-600', maxCapacity: 132, maxPayload: 15.6 },
            { model: 'Boeing 737-700', maxCapacity: 149, maxPayload: 17.5 },
            { model: 'Boeing 737-700ER', maxCapacity: 149, maxPayload: 17.0 },
            { model: 'Boeing 737-800', maxCapacity: 189, maxPayload: 20.3 },
            { model: 'Boeing 737-800', maxCapacity: 189, maxPayload: 21.3 },
            { model: 'Boeing 737-900ER', maxCapacity: 220, maxPayload: 23.0 },
            { model: 'Boeing 737-MAX8', maxCapacity: 189, maxPayload: 18.9 },
            { model: 'Boeing 737-MAX8-200', maxCapacity: 200, maxPayload: 20.0 },
            { model: 'Boeing 737-MAX9', maxCapacity: 210, maxPayload: 22.0 },
            { model: 'Boeing 747-100B', maxCapacity: 520, maxPayload: 52.0 },
            { model: 'Boeing 747-200B', maxCapacity: 595, maxPayload: 68.0 },
            { model: 'Boeing 747-300', maxCapacity: 608, maxPayload: 66.0 },
            { model: 'Boeing 747-400', maxCapacity: 660, maxPayload: 67.50 },
            { model: 'Boeing 747-8I', maxCapacity: 730, maxPayload: 76.0 },
            { model: 'Boeing 757-200', maxCapacity: 239, maxPayload: 26.7 },
            { model: 'Boeing 757-300', maxCapacity: 295, maxPayload: 31.0 },
            { model: 'Boeing 767-200ER', maxCapacity: 290, maxPayload: 35.59 },
            { model: 'Boeing 767-300ER', maxCapacity: 351, maxPayload: 43.8 },
            { model: 'Boeing 767-400ER', maxCapacity: 409, maxPayload: 46.50 },
            { model: 'Boeing 777-200', maxCapacity: 440, maxPayload: 57.4 },
            { model: 'Boeing 777-200ER', maxCapacity: 440, maxPayload: 59.4 },
            { model: 'Boeing 777-200LR', maxCapacity: 440, maxPayload: 64.0 },
            { model: 'Boeing 777-300', maxCapacity: 550, maxPayload: 66.9 },
            { model: 'Boeing 777-300ER', maxCapacity: 550, maxPayload: 69.9 },
            { model: 'Boeing 787-10', maxCapacity: 440, maxPayload: 44.0 },
            { model: 'Boeing 787-8', maxCapacity: 381, maxPayload: 43.3 },
            { model: 'Boeing 787-9', maxCapacity: 420, maxPayload: 42.0 },
            { model: 'Boeing B727-100', maxCapacity: 131, maxPayload: 13.8 },
            { model: 'Boeing DC-3', maxCapacity: 32, maxPayload: 3.2 },
            { model: 'Boeing DC8-55', maxCapacity: 189, maxPayload: 20.46 },
            { model: 'Boeing DC8-73', maxCapacity: 259, maxPayload: 26.37 },
            { model: 'Boeing MD-11', maxCapacity: 410, maxPayload: 52.6 },
            { model: 'Boeing MD-83', maxCapacity: 167, maxPayload: 19.20 },
            { model: 'Boeing MD-90-30', maxCapacity: 167, maxPayload: 19.00 },
            { model: 'Bombardier CRJ-1000', maxCapacity: 104, maxPayload: 12.0 },
            { model: 'Bombardier CRJ-200', maxCapacity: 50, maxPayload: 6.1 },
            { model: 'Bombardier CRJ-550', maxCapacity: 57, maxPayload: 8.5 },
            { model: 'Bombardier CRJ-700', maxCapacity: 78, maxPayload: 8.5 },
            { model: 'Bombardier CRJ-900', maxCapacity: 90, maxPayload: 10.6 },
            { model: 'Bombardier Q-200', maxCapacity: 40, maxPayload: 4.6 },
            { model: 'Bombardier Q-300', maxCapacity: 56, maxPayload: 6.1 },
            { model: 'Bombardier Q-400', maxCapacity: 80, maxPayload: 8.5 },
            { model: 'Comac C909', maxCapacity: 90, maxPayload: 10.0 },
            { model: 'Comac C919', maxCapacity: 174, maxPayload: 18.9 },
            { model: 'Dassault Aviation F900-B', maxCapacity: 19, maxPayload: 2.0 },
            { model: 'Dornier D328-100', maxCapacity: 32, maxPayload: 4.8 },
            { model: 'Embraer E190-E2', maxCapacity: 114, maxPayload: 11.4 },
            { model: 'Embraer E195-E2', maxCapacity: 146, maxPayload: 14.6 },
            { model: 'Embraer EMB-120', maxCapacity: 30, maxPayload: 3.3 },
            { model: 'Embraer ERJ-135', maxCapacity: 37, maxPayload: 4.5 },
            { model: 'Embraer ERJ-140', maxCapacity: 44, maxPayload: 5.3 },
            { model: 'Embraer ERJ-145', maxCapacity: 50, maxPayload: 5.8 },
            { model: 'Embraer ERJ-145XR', maxCapacity: 50, maxPayload: 6.0 },
            { model: 'Embraer ERJ-170', maxCapacity: 80, maxPayload: 9.8 },
            { model: 'Embraer ERJ-175', maxCapacity: 88, maxPayload: 10.4 },
            { model: 'Embraer ERJ-190', maxCapacity: 114, maxPayload: 13.1 },
            { model: 'Embraer ERJ-195', maxCapacity: 124, maxPayload: 13.6 },
            { model: 'Fokker F-100', maxCapacity: 122, maxPayload: 12.2 },
            { model: 'Gulfstream G650', maxCapacity: 19, maxPayload: 2.9 },
            { model: 'Ilyushin Il-114', maxCapacity: 64, maxPayload: 6.5 },
            { model: 'Ilyushin Il-96-300', maxCapacity: 300, maxPayload: 40.0 },
            { model: 'Ilyushin Il-96M', maxCapacity: 436, maxPayload: 45.0 },
            { model: 'IPTN CN-235', maxCapacity: 44, maxPayload: 4.5 },
            { model: 'Lockheed L-100', maxCapacity: 128, maxPayload: 23.2 },
            { model: 'Lockheed L-1011-200', maxCapacity: 400, maxPayload: 46.0 },
            { model: 'Lockheed L-1011-500', maxCapacity: 330, maxPayload: 41.0 },
            { model: 'Lockheed L-1049G', maxCapacity: 106, maxPayload: 12.0 },
            { model: 'Saab S-2000', maxCapacity: 58, maxPayload: 5.9 },
            { model: 'Saab S-340B', maxCapacity: 37, maxPayload: 3.7 },
            { model: 'Sukhoi SSJ-100-95', maxCapacity: 98, maxPayload: 12.2 },
            { model: 'Tupolev TU-214-210', maxCapacity: 210, maxPayload: 25.20 },
        ];

        let selectedPlaneIndex = 0; // Default to 'Custom Aircraft'

        // --- CORE LOGIC CONSTANTS ---
        const MAX_DAY_MINUTES = 24 * 60; // 1440 minutes
        const FIXED_WAVES = 10; // Fixed number of rows when duration limit is off

        // NEW PHYSICS CONSTANTS
        const SEAT_WEIGHTS = {
          E: 0.1,          /* Economy seat weight (Tonnes) */
          B: 0.12498942917, /* Business seat weight (Tonnes) - High Precision */
          F: 0.15,         /* First seat weight (Tonnes) */
          C: 1,            /* Cargo unit weight (Tonnes) */
        };

        const SEAT_SPACE_MULTIPLIERS = {
          E: 1,
          B: 1.80338266394,
          F: 4.20197044351,
        };

        // --- DOM REFERENCES ---
        const planeSelector = document.getElementById('planeSelector');
        const planeDropdown = document.getElementById('planeDropdown');
        const planeList = document.getElementById('planeList');
        const planeSearch = document.getElementById('planeSearch');
        const selectedPlaneName = document.getElementById('selectedPlaneName');
        const inputCapacity = document.getElementById('inputCapacity');
        const inputPayload = document.getElementById('inputPayload');
        const customHint = document.getElementById('customHint');
        const resultsBody = document.getElementById('resultsBody');
        const hoursInput = document.getElementById('hoursInput');
        const minutesInput = document.getElementById('minutesInput');
        const durationSummary = document.getElementById('durationSummary');
        const durationToggle = document.getElementById('durationToggle'); 
        const durationContent = document.getElementById('durationContent'); // Reference to the hours/minutes section
        
        const demandInputs = ['demandEco', 'demandBus', 'demandFirst', 'demandCargo'].map(id => document.getElementById(id));
        const allInputs = [inputCapacity, inputPayload, ...demandInputs, hoursInput, minutesInput, durationToggle];

        /**
         * Converts total minutes to "Hh Mm" format.
         */
        function formatDuration(totalMinutes) {
            if (totalMinutes < 0) return "0h 0m";
            const hours = Math.floor(totalMinutes / 60);
            const minutes = totalMinutes % 60;
            return `${hours}h ${minutes}m`;
        }

        /**
         * Calculates the optimal seat configuration for a single demand type based on user-specified rules.
         */
        function calculateRequiredSeats(rawDemand, totalPassengerSlots) {
            if (rawDemand <= 0) return 0;
            if (totalPassengerSlots <= 0) return rawDemand; 
            
            // 1. Adjust Demand for Odd Numbers
            let adjustedDemand = rawDemand - (rawDemand % 2); 
            if (adjustedDemand < 0) adjustedDemand = 0;
            
            // 2. Calculate required capacity (can be fractional)
            const requiredCapacity = adjustedDemand / totalPassengerSlots;

            // 3. Apply the Zero Threshold/Rounding Down Logic
            if (requiredCapacity === 0) {
                return 0;
            } else if (requiredCapacity < 1) {
                // If the required capacity is fractional but less than 1 
                return 0;
            } else {
                // Use Math.floor() to round the fractional seat number down 
                // to the nearest whole number, as requested.
                return Math.floor(requiredCapacity);
            }
        }

        /**
         * Toggles the visibility of the duration inputs and summary based on the toggle state.
         * @param {boolean} isActive - True if the 24H limit toggle is ON.
         */
        function toggleDurationInputs(isActive) {
            // Toggle visibility using the defined fade-in/fade-out classes
            durationContent.classList.toggle('fade-out', !isActive);
            durationContent.classList.toggle('fade-in', isActive);
            
            durationSummary.classList.toggle('fade-out', !isActive);
            durationSummary.classList.toggle('fade-in', isActive);
        }

        /**
         * Calculates the optimal seat configurations and updates the table.
         */
        function calculateSeats() {
            // 1. INPUT GATHERING
            const planeCapacity = parseInt(inputCapacity.value) || 0;
            const planePayload = parseFloat(inputPayload.value) || 0;
            const durationHours = parseInt(hoursInput.value) || 0;
            const durationMinutes = parseInt(minutesInput.value) || 0;
            const isDurationLimitActive = durationToggle.checked;
            
            const totalFlightMinutes = (durationHours * 60) + durationMinutes;

            const demand = {
                eco: parseInt(document.getElementById('demandEco').value) || 0,
                bus: parseInt(document.getElementById('demandBus').value) || 0,
                first: parseInt(document.getElementById('demandFirst').value) || 0,
                cargo: parseFloat(document.getElementById('demandCargo').value) || 0,
            };
            
            // Update UI visibility based on toggle state
            toggleDurationInputs(isDurationLimitActive);

            // Clear previous results
            resultsBody.innerHTML = '';
            
            if (planeCapacity <= 0 || planePayload <= 0) {
                // Update summary even if hidden, just in case user toggles it back
                document.querySelector('#durationSummary > div').innerHTML = `<p class="text-red-400">Please set valid input values for Aircraft (capacity > 0).</p>`;
                resultsBody.innerHTML = `
                    <tr>
                        <td colspan="7" class="p-4 text-slate-500 italic">
                            <i data-lucide="alert-triangle" class="w-4 h-4 inline mr-1 align-sub"></i> 
                            Please set a valid aircraft (capacity > 0).
                        </td>
                    </tr>
                `;
                lucide.createIcons();
                return;
            }

            // 2. Determine Max Waves (Legs) to Display based on toggle
            const maxPossibleWavesBasedOnTime = Math.floor(MAX_DAY_MINUTES / totalFlightMinutes);
            let maxWavesToDisplay;

            if (isDurationLimitActive) {
                maxWavesToDisplay = maxPossibleWavesBasedOnTime;
            } else {
                // Toggle OFF: Fixed 10 rows
                maxWavesToDisplay = FIXED_WAVES;
            }

            // Update Duration Summary
            const flightDurationString = formatDuration(totalFlightMinutes);
            let summaryHtml = ``;
            const summaryContainer = document.querySelector('#durationSummary > div');


            if (isDurationLimitActive) {
                 if (totalFlightMinutes <= 0) {
                     summaryHtml = `<p class="text-red-400">Please set a valid flight duration (> 0 minutes).</p>`;
                 } else {
                    summaryHtml = `
                        <p>Return Trip Duration: <span class="text-cyan-400 font-mono">${flightDurationString}</span></p>
                        <p class="pt-1 text-base text-white">Max Return Trips in 24h: <span class="text-lg font-bold text-cyan-400">${maxWavesToDisplay}</span></p>
                        <p class="text-[10px] text-cyan-400 pt-2 font-semibold tracking-wide">
                            // Display limited by 24h cycle.
                        </p>
                    `;
                 }
            } else {
                summaryHtml = `
                    <p class="pt-1 text-base text-white">Analysis Waves: <span class="text-lg font-bold text-white">${FIXED_WAVES}</span></p>
                    <p class="text-[10px] text-red-400 pt-2 font-semibold tracking-wide">
                        // Fixed ${FIXED_WAVES}-wave analysis, 24H limit DISABLED.
                    </p>
                `;
            }

            summaryContainer.innerHTML = summaryHtml;

            // Check for unfeasible duration only if the limit is active and input is positive
            if (isDurationLimitActive && totalFlightMinutes > 0 && maxWavesToDisplay < 1) {
                 resultsBody.innerHTML = `
                    <tr>
                        <td colspan="7" class="p-4 text-red-500 italic">
                            <i data-lucide="x-octagon" class="w-4 h-4 inline mr-1 align-sub"></i> 
                            Flight duration (${flightDurationString}) is longer than 24 hours.
                        </td>
                    </tr>
                `;
                lucide.createIcons();
                return;
            } else if (totalFlightMinutes <= 0 && isDurationLimitActive) {
                 // Prevent table render if duration is 0 and limit is active
                 return;
            }


            const rowsHtml = [];

            // 3. ITERATE AND CALCULATE FOR EACH WAVE COUNT
            for (let waves = 1; waves <= maxWavesToDisplay && waves <= 100; waves++) {
                
                // Total slots provided by one seat over all waves = waves * 2 (one RT trip per wave)
                const totalPassengerSlots = waves * 2; 

                // Calculate required seats using the new user-defined logic
                const required = {
                    eco: calculateRequiredSeats(demand.eco, totalPassengerSlots),
                    bus: calculateRequiredSeats(demand.bus, totalPassengerSlots),
                    first: calculateRequiredSeats(demand.first, totalPassengerSlots),
                    // Cargo remains standard: Daily RT Cargo Demand / Total One-Way Legs (waves)
                    cargo: (demand.cargo / waves), 
                };
                
                // --- CAPACITY CHECK (Physical Space) ---
                // Total required capacity in terms of Economy-Equivalent seats
                const totalRequiredCapacityEquivalent = 
                    (required.eco * SEAT_SPACE_MULTIPLIERS.E) +
                    (required.bus * SEAT_SPACE_MULTIPLIERS.B) +
                    (required.first * SEAT_SPACE_MULTIPLIERS.F);

                // --- PAYLOAD CHECK (Total Weight) ---
                const requiredPayload = 
                    (required.eco * SEAT_WEIGHTS.E) +
                    (required.bus * SEAT_WEIGHTS.B) +
                    (required.first * SEAT_WEIGHTS.F) +
                    (required.cargo * SEAT_WEIGHTS.C);

                // Check if any passenger class requires 0 seats
                const hasZeroSeats = required.eco === 0 && required.bus === 0 && required.first === 0;

                // --- VALIDATION & STYLING LOGIC ---
                let validationIcon = 'check';
                let validationColor = 'text-emerald-400';
                let validationText = 'Valid';
                let rowClass = 'text-slate-300';
                let hoverClass = 'hover:bg-white/5';

                if (hasZeroSeats) {
                    // Precedence 1: LOW DEMAND (Greyed out) - Fades row text to slate-600
                    validationIcon = 'info';
                    validationColor = 'text-slate-500';
                    validationText = 'LOW DEMAND'; 
                    rowClass = 'text-slate-600 bg-black/10 italic'; 
                    hoverClass = 'hover:bg-black/20';
                } else {
                    // Precedence 2: Capacity/Payload Check
                    const isCapacityValid = totalRequiredCapacityEquivalent <= planeCapacity;
                    const isPayloadValid = requiredPayload <= planePayload;
                    
                    if (!isCapacityValid || !isPayloadValid) { 
                        validationIcon = 'x';
                        validationColor = 'text-red-500';
                        validationText = (!isCapacityValid && !isPayloadValid) ? 'BOTH' : (!isCapacityValid ? 'CAPACITY' : 'PAYLOAD');
                        
                        // FADE OUT: Apply opacity-60 to the entire row if invalid
                        rowClass = 'text-slate-500 opacity-60'; 
                        hoverClass = 'hover:opacity-100 hover:bg-red-950/20'; // Highlight on hover
                    }
                }
                
                // --- Payload Bar Calculation ---
                // Payload Bar
                const payloadUsageRawPercent = (requiredPayload / planePayload) * 100;
                const payloadBarColor = getBarColor(payloadUsageRawPercent);
                // The width should be capped at 100% for visual purposes
                const payloadBarWidthPercent = Math.min(100, payloadUsageRawPercent);


                // Capacity Bar
                const capacityUsageRawPercent = (totalRequiredCapacityEquivalent / planeCapacity) * 100;
                const capacityBarColor = getBarColor(capacityUsageRawPercent);
                // The width should be capped at 100% for visual purposes
                const capacityBarWidthPercent = Math.min(100, capacityUsageRawPercent);

                // --- Generate HTML Row ---
                const row = `
                    <tr class="${rowClass} ${hoverClass} transition-colors duration-200">
                        <td class="p-3 text-cyan-400 font-semibold">${waves}</td>
                        <td class="p-3">${required.eco.toLocaleString()}</td>
                        <td class="p-3">${required.bus.toLocaleString()}</td>
                        <td class="p-3">${required.first.toLocaleString()}</td>
                        <td class="p-3 text-amber-500">${required.cargo.toFixed(2)}</td>
                        
                        <!-- PAYLOAD BAR -->
                        <td class="p-3 font-bold">
                            ${requiredPayload.toFixed(2)}
                            <span class="text-[10px] font-normal text-gray-500">/${planePayload.toFixed(2)}</span>
                            <div class="w-full h-1 bg-slate-800 rounded-full mt-1 overflow-hidden">
                            <div class="h-1 ${payloadBarColor} transition-all duration-500" style="width: ${payloadBarWidthPercent}%;"></div>
                            </div>
                        </td>

                        <!-- CAPACITY BAR -->
                        <td class="p-3 font-bold">
                            ${totalRequiredCapacityEquivalent.toFixed(2)}
                            <span class="text-[10px] font-normal text-gray-500">/${planeCapacity.toFixed(2)}</span>
                            <div class="w-full h-1 bg-slate-800 rounded-full mt-1 overflow-hidden">
                            <div class="h-1 ${capacityBarColor} transition-all duration-500" style="width: ${capacityBarWidthPercent}%;"></div>
                            </div>
                        </td>

                        <td class="p-3 font-bold ${validationColor} flex items-center justify-center gap-1 min-h-[50px] uppercase">
                            <i data-lucide="${validationIcon}" class="w-4 h-4"></i>
                            <span class="text-[10px]">${validationText}</span>
                        </td>
                    </tr>
                `;
                rowsHtml.push(row);
            } // End of wave loop

            resultsBody.innerHTML = rowsHtml.join('');
            lucide.createIcons(); // Re-render icons after DOM update
        }

        // --- UI & EVENT HANDLERS ---
        
        /**
         * Populates the aircraft dropdown list.
         */
        function setupPlaneDropdown() {
            planeList.innerHTML = PLANES_DB.map((plane, index) => `
                <div 
                    class="plane-option px-3 py-2 cursor-pointer hover:bg-cyan-700/20 hover:text-cyan-200 text-sm transition-colors duration-150 truncate" 
                    data-index="${index}"
                >
                    ${plane.model}
                </div>
            `).join('');

            document.querySelectorAll('.plane-option').forEach(option => {
                option.addEventListener('click', (e) => {
                    selectedPlaneIndex = parseInt(e.target.dataset.index);
                    const plane = PLANES_DB[selectedPlaneIndex];
                    selectedPlaneName.textContent = plane.model;
                    planeDropdown.classList.add('hidden');
                    updateCapacityInputs();
                });
            });
        }
        
        /**
         * Sets input fields based on the selected aircraft.
         */
        function updateCapacityInputs() {
            const plane = PLANES_DB[selectedPlaneIndex];
            
            // Note: capacity is integer, payload is float.
            const isCustom = selectedPlaneIndex === 0;

            inputCapacity.disabled = !isCustom;
            inputPayload.disabled = !isCustom;
            
            customHint.classList.toggle('hidden', !isCustom);
            
            if (!isCustom) {
                // Use plane's actual stats
                inputCapacity.value = plane.maxCapacity;
                inputPayload.value = plane.maxPayload.toFixed(2);
                customHint.textContent = '// PLANE STATS LOCKED';
            } else {
                // Keep default custom values or user-entered values
                customHint.textContent = '// MANUAL OVERRIDE ENABLED';
            }

            calculateSeats(); // Trigger calculation when plane changes
        }
        
        /**
         * Populates the hours dropdown from 1 to 24.
         */
        function setupDurationInputs() {
            for (let h = 1; h <= 24; h++) {
                const option = document.createElement('option');
                option.value = h;
                option.textContent = h.toString().padStart(2, '0');
                hoursInput.appendChild(option);
            }
            // Set default duration to a common flight time (e.g., 8h 00m)
            hoursInput.value = 8; 
        }

        function getBarColor(value) {
            // Ensure value is a number and clamp it between 0 and 100
            const percentage = Math.max(0, Math.min(100, parseFloat(value) || 0));

            if (percentage >= 95) {
                return 'bg-red-600'; // Excellent
            } else if (percentage >= 80) {
                return 'bg-yellow-400'; // Good/Warning
            } else if (percentage >= 50) {
                return 'bg-amber-500'; // Needs attention
            } else {
                return 'bg-green-600'; // Poor
            }
        }

        // --- INITIALIZATION ---
        function init() {
            lucide.createIcons(); // Initialize all icons

            // Setup inputs
            setupPlaneDropdown();
            setupDurationInputs();
            
            // Set initial state
            selectedPlaneName.textContent = PLANES_DB[0].model; // Set initial text to Custom
            
            // Event listeners for calculation triggers
            allInputs.forEach(input => {
                // Use 'change' for select/checkbox, 'input' for text/number
                const eventType = (input.type === 'checkbox' || input.tagName === 'SELECT') ? 'change' : 'input';
                input.addEventListener(eventType, calculateSeats);
            });
            
            // Event Listeners for UI interaction
            planeSelector.addEventListener('click', () => {
                planeDropdown.classList.toggle('hidden');
                planeSearch.value = '';
                planeSearch.focus();
                // Show all options on toggle
                document.querySelectorAll('.plane-option').forEach(el => el.classList.remove('hidden'));
            });

            planeSearch.addEventListener('input', (e) => {
                const filter = e.target.value.toLowerCase();
                document.querySelectorAll('.plane-option').forEach(option => {
                    const model = option.textContent.toLowerCase();
                    option.classList.toggle('hidden', !model.includes(filter));
                });
            });
            
            // Close dropdown when clicking outside
            document.addEventListener('click', (e) => {
                if (!planeSelector.contains(e.target) && !planeDropdown.contains(e.target)) {
                    planeDropdown.classList.add('hidden');
                }
            });
            
            // Initial calculation and UI setup
            calculateSeats();
        }

        window.onload = init;
    </script>
</body>
</html>