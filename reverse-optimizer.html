<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Airlines Manager Dynamic Seat Optimiser</title>
    
    <!-- Tailwind CSS --><script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons --><script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Google Fonts: Rajdhani for that futuristic HUD look --><link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;600;700&display=swap" rel="stylesheet">

    <style>
        /* Typography Override */
        body {
            font-family: 'Rajdhani', sans-serif;
        }

        /* Chrome, Safari, Edge, Opera */
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
        }

        /* Firefox */
        input[type=number] {
        -moz-appearance: textfield;
        }

        /* Background Pattern */
        .bg-grid-pattern {
            /* The base background color is set by Tailwind bg-[#050508] in the body tag */
            background: 
                linear-gradient(to right, #ffffff10 1px, transparent 1px) 0 0,
                linear-gradient(to bottom, #ffffff10 1px, transparent 1px) 0 0;
            background-size: 20px 20px;
            background-repeat: repeat; /* Explicitly set repeat */
        }
        
        /* The body class still needs to manage the background color */
        body.bg-grid-pattern {
            background-color: #050508;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }
        ::-webkit-scrollbar-track {
            background: #0f172a; 
        }
        ::-webkit-scrollbar-thumb {
            background: #22d3ee;
            border-radius: 3px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #67e8f9;
        }

        /* Toggle Switch */
        .toggle-checkbox {
            position: absolute;
            left: 0;
            margin: 0;
            padding: 0;
            opacity: 0; /* Hide native checkbox */
        }
        .toggle-label {
            position: relative;
            display: block;
            width: 40px;
            height: 20px;
            border-radius: 10px;
            background-color: #334155;
            cursor: pointer;
            transition: all 0.3s;
        }
        .toggle-label::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background-color: white;
            transition: all 0.3s;
        }
        .toggle-checkbox:checked + .toggle-label {
            background-color: #22d3ee;
            box-shadow: 0 0 8px rgba(34, 211, 238, 0.4);
        }
        .toggle-checkbox:checked + .toggle-label::after {
            transform: translateX(20px);
        }

        /* Disabled Input Styling */
        input:disabled {
            background-color: transparent;
            border-color: transparent;
            color: #64748b;
            cursor: not-allowed;
            padding-left: 0;
            text-align: right;
        }

        /* Neon Glow Effects */
        .glow-text {
            text-shadow: 0 0 3px rgba(34, 211, 238, 0.3);
        }
        .glow-border:focus-within {
            box-shadow: 0 0 10px rgba(34, 211, 238, 0.15);
            border-color: #22d3ee;
        }
        
        /* Table Styling Overrides: Remove vertical borders (dividers) */
        th, td {
            border-right: none !important; /* Forces removal of Tailwind's border-r classes */
        }
        thead th {
            border-left: none !important;
            border-right: none !important;
        }

        /* Utility for animation/transition */
        .fade-in {
            opacity: 1;
            max-height: 500px;
            transition: opacity 0.3s ease-in, max-height 0.5s ease-in;
        }
        .fade-out {
            opacity: 0;
            max-height: 0;
            overflow: hidden;
            transition: opacity 0.3s ease-out, max-height 0.5s ease-out;
        }

    </style>
</head>
<body class="bg-[#050508] text-slate-300 min-h-screen selection:bg-cyan-500/20 selection:text-cyan-200 bg-grid-pattern relative overflow-x-hidden">

    <!-- Ambient Light Effect --><div class="fixed top-0 left-1/2 -translate-x-1/2 w-[700px] h-[350px] bg-cyan-900/5 rounded-full blur-[100px] -z-10 pointer-events-none"></div>

    <!-- Main Container --><div class="max-w-7xl mx-auto p-4 md:p-6">
        
        <header class="mb-6 flex items-center justify-between border-b border-white/10 pb-4">
            <div class="flex items-center gap-3">
                <div class="p-2.5 bg-cyan-950/20 border border-cyan-500/20 rounded-lg shadow-[0_0_10px_rgba(34,211,238,0.1)]">
                    <i data-lucide="plane" class="w-6 h-6 text-cyan-300"></i>
                </div>
                <div>
                    <h1 class="text-3xl font-bold text-white tracking-wide glow-text uppercase">Seat Optimiser</h1>
                    <p class="text-slate-600 text-xs font-semibold tracking-widest uppercase">AM Tycoon // Configuration Assistant // Made by <a href="https://su-consultancy.com" target="_blank" rel="noopener noreferrer" class="hover:underline hover:text-cyan-500 hover:transition hover:duration-300">Umut Yelbaşı</a></p>
                </div>
            </div>

            <nav class="pt-4 mt-2"> <!-- Removed border-t -->
                <ul class="flex space-x-8 text-base font-semibold">
                    <li>
                        <!-- Active Link: Reduced bottom padding to pb-0.5 for a tighter border -->
                        <a href="index.html" class="text-cyan-400 border-b-2 border-cyan-400 pb-0.5 transition duration-200">
                            SEAT OPTIMISER
                        </a>
                    </li>
                    <li>
                        <!-- Placeholder Link: Reduced bottom padding for sleeker hover -->
                        <a href="reverse-optimizer.html" class="text-slate-500 hover:text-cyan-400 hover:border-b-2 hover:border-cyan-700 pb-0.5 transition duration-200">
                            REVERSE OPTIMISER
                        </a>
                    </li>
                    <li>
                        <!-- Placeholder Link: Reduced bottom padding for sleeker hover -->
                        <a href="#" class="text-slate-500 hover:text-cyan-400 hover:border-b-2 hover:border-cyan-700 pb-0.5 transition duration-200">
                            R&D TRACKER
                        </a>
                    </li>
                </ul>
            </nav>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-4">
            
            <!-- LEFT COLUMN: Inputs --><div class="lg:col-span-4 space-y-4">
                
                <!-- 1. Aircraft Selection Card --><div class="bg-[#0f1014]/80 backdrop-blur-md border border-white/10 rounded-xl p-4 shadow-lg relative z-30 glow-border transition-colors duration-300">
                    <h2 class="text-sm font-bold text-cyan-300 mb-3 flex items-center gap-2 uppercase tracking-wider">
                        <i data-lucide="search" class="w-4 h-4"></i> Aircraft Selection
                    </h2>
                    
                    <div class="relative">
                        <!-- Clickable Selector --><div 
                            id="planeSelector"
                            class="w-full bg-black/40 border border-white/10 rounded px-3 py-2.5 text-white cursor-pointer hover:border-cyan-500/30 hover:bg-cyan-950/5 transition-all flex justify-between items-center group"
                        >
                            <span id="selectedPlaneName" class="truncate font-semibold text-sm">Select Aircraft...</span>
                            <i data-lucide="chevron-down" class="w-4 h-4 text-slate-500 group-hover:text-cyan-300 transition-colors"></i>
                        </div>

                        <!-- Dropdown with Search Inside --><div 
                            id="planeDropdown" 
                            class="absolute z-50 left-0 right-0 mt-1 bg-[#1a1b21] border border-cyan-500/20 rounded shadow-[0_10px_30px_-10px_rgba(0,0,0,0.6)] hidden overflow-hidden"
                        >
                            <div class="p-2 border-b border-white/5 bg-[#1a1b21] sticky top-0">
                                <input 
                                    type="text" 
                                    id="planeSearch" 
                                    placeholder="FILTER MODELS..." 
                                    class="w-full bg-black/50 border border-white/10 rounded px-3 py-1.5 text-sm text-cyan-200 placeholder-slate-600 focus:border-cyan-400 focus:outline-none uppercase tracking-wide"
                                >
                            </div>
                            <div id="planeList" class="max-h-60 overflow-y-auto">
                                <!-- Options injected by JS --></div>
                        </div>
                    </div>

                    <!-- Stats / Custom Inputs --><div id="selectedPlaneStats" class="mt-3 pt-3 border-t border-white/5 space-y-2">
                        <div class="flex justify-between items-center">
                            <span class="text-slate-600 text-xs font-bold uppercase tracking-wider">Max Capacity (Seats)</span>
                            <input type="number" id="inputCapacity" value="300" class="bg-transparent border-b border-white/10 hover:border-cyan-500/30 focus:border-cyan-400 px-0 py-0.5 text-white text-right w-24 outline-none font-mono text-sm transition-colors">
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-slate-600 text-xs font-bold uppercase tracking-wider">Max Payload (Tonnes)</span>
                            <div class="relative">
                                <input type="number" id="inputPayload" step="0.1" value="60.00" class="bg-transparent border-b border-white/10 hover:border-cyan-500/30 focus:border-cyan-400 px-0 py-0.5 text-white text-right w-24 outline-none font-mono text-sm transition-colors">
                            </div>
                        </div>
                        <div id="customHint" class="text-[10px] text-cyan-400 pt-2 text-right font-semibold tracking-wide">
                            // Using default custom values
                        </div>
                    </div>
                </div>

                <!-- 2. Route Demand Card --><div class="bg-[#0f1014]/80 backdrop-blur-md border border-white/10 rounded-xl p-4 shadow-lg glow-border">
                    <h2 class="text-sm font-bold text-cyan-300 mb-3 flex items-center gap-2 uppercase tracking-wider">
                        <i data-lucide="users" class="w-4 h-4"></i> Route Demand (24H - Return Trip)
                    </h2>
                    <!-- Single Row for all 4 inputs --><div class="grid grid-cols-4 gap-2">
                        <!-- Economy --><div class="group">
                            <label class="block text-[10px] font-bold text-slate-600 mb-1 text-center uppercase group-hover:text-cyan-500 transition-colors">Economy</label>
                            <input type="number" id="demandEco" value="0" class="w-full bg-black/40 border border-white/10 rounded px-1 py-2 text-white text-center focus:border-cyan-400 outline-none transition-all font-mono text-sm hover:bg-cyan-950/5">
                        </div>
                        <!-- Business --><div class="group">
                            <label class="block text-[10px] font-bold text-slate-600 mb-1 text-center uppercase group-hover:text-emerald-500 transition-colors">Business</label>
                            <input type="number" id="demandBus" value="0" class="w-full bg-black/40 border border-white/10 rounded px-1 py-2 text-white text-center focus:border-emerald-400 outline-none transition-all font-mono text-sm hover:bg-emerald-950/5">
                        </div>
                        <!-- First --><div class="group">
                            <label class="block text-[10px] font-bold text-slate-600 mb-1 text-center uppercase group-hover:text-purple-500 transition-colors">First</label>
                            <input type="number" id="demandFirst" value="0" class="w-full bg-black/40 border border-white/10 rounded px-1 py-2 text-white text-center focus:border-purple-400 outline-none transition-all font-mono text-sm hover:bg-purple-950/5">
                        </div>
                        <!-- Cargo --><div class="group">
                            <label class="block text-[10px] font-bold text-slate-600 mb-1 text-center uppercase group-hover:text-amber-500 transition-colors">Cargo (Tonnes RT)</label>
                            <input type="number" id="demandCargo" value="0" step="0.1" class="w-full bg-black/40 border border-white/10 rounded px-1 py-2 text-white text-center focus:border-amber-400 outline-none transition-all font-mono text-sm hover:bg-amber-950/5">
                        </div>
                    </div>
                </div>

                <!-- 3. Flight Duration Card -->
                <div class="bg-[#0f1014]/80 backdrop-blur-md border border-white/10 rounded-xl shadow-lg relative z-20 overflow-hidden glow-border">
                    
                    <!-- Header with Toggle -->
                    <div class="p-4 flex justify-between items-center border-b border-white/5">
                        <h2 class="text-sm font-bold text-cyan-300 flex items-center gap-2 uppercase tracking-wider">
                            <i data-lucide="clock" class="w-4 h-4"></i> Flight Duration
                        </h2>
                        <div class="flex items-center gap-2">
                            <span class="text-[10px] text-slate-500 uppercase font-semibold">Limit flights by duration</span>
                            <input type="checkbox" id="durationToggle" class="toggle-checkbox" checked>
                            <label for="durationToggle" class="toggle-label"></label>
                        </div>
                    </div>
                    
                    <!-- Content (Inputs - Hidden when toggle is off) -->
                    <div id="durationContent" class="fade-in">
                        <div class="p-4 border-b border-white/5">
                            <div class="grid grid-cols-2 gap-3">
                                <div>
                                    <label class="block text-[10px] font-bold text-slate-600 mb-1 uppercase">Hours</label>
                                    <div class="relative">
                                        <select id="hoursInput" class="w-full bg-black/40 border border-white/10 rounded px-3 py-2 text-white focus:border-cyan-400 outline-none appearance-none text-sm font-mono">
                                            <!-- JS will populate 1-24 --></select>
                                        <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-slate-500">
                                            <i data-lucide="chevron-down" class="w-3 h-3"></i>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-[10px] font-bold text-slate-600 mb-1 uppercase">Minutes</label>
                                    <div class="relative">
                                        <select id="minutesInput" class="w-full bg-black/40 border border-white/10 rounded px-3 py-2 text-white focus:border-cyan-400 outline-none appearance-none text-sm font-mono">
                                            <option value="0">00</option>
                                            <option value="15">15</option>
                                            <option value="30">30</option>
                                            <option value="45">45</option>
                                        </select>
                                        <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-slate-500">
                                            <i data-lucide="chevron-down" class="w-3 h-3"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Calculation Summary (Hidden when toggle is off) -->
                    <div id="durationSummary" class="fade-in text-xs font-semibold space-y-2 bg-black/40">
                        <div class="p-4">
                            <!-- Summary injected by JS -->
                        </div>
                    </div>
                </div>

            </div>

            <!-- RIGHT COLUMN: Results --><div class="lg:col-span-8">
                
                <!-- Table --><div class="bg-[#0f1014]/90 border border-white/10 rounded-xl overflow-hidden shadow-[0_0_30px_-10px_rgba(0,0,0,0.5)] flex flex-col h-full">
                    <div class="overflow-x-auto flex-1">
                        <table class="w-full text-center border-collapse">
                            <thead>
                                <tr class="bg-black/40 text-slate-600 text-[10px] uppercase tracking-widest border-b border-white/5 sticky top-0">
                                    <th class="p-3 font-bold min-w-[50px] text-cyan-400">Waves (Legs)</th>
                                    <th class="p-3 font-bold text-cyan-500">Economy</th>
                                    <th class="p-3 font-bold text-emerald-500">Business</th>
                                    <th class="p-3 font-bold text-purple-500">First</th>
                                    <th class="p-3 font-bold text-amber-500">Cargo (t)</th>
                                    <th class="p-3 font-bold text-red-400 min-w-[100px]">Payload (tonnes)</th>
                                    <th class="p-3 font-bold text-red-400 min-w-[100px]">Capacity (seats)</th>
                                    <th class="p-3 font-bold text-green-400">Valid?</th>
                                </tr>
                            </thead>
                            <tbody class="text-sm font-mono text-slate-300 divide-y divide-white/5" id="resultsBody">
                                <!-- Rows generated by JS --></tbody>
                        </table>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script>
        // Global Constants (Same as previous app for consistency)
        const WEIGHT_PER_FIRST = 150; // kg (includes baggage)
        const WEIGHT_PER_BUSINESS = 100; // kg
        const WEIGHT_PER_ECONOMY = 80; // kg
        const WEIGHT_PER_CARGO_TON = 1000; // kg

        // Mock Aircraft Data (Payload in KG, Seats total)
        const AIRCRAFT_DATA = [
            { id: 'A320', model: 'Airbus A320-200', seats: 180, maxPayloadKG: 21000, price: 101.0 },
            { id: '737MAX', model: 'Boeing 737 MAX 8', seats: 178, maxPayloadKG: 20000, price: 125.0 },
            { id: '787-9', model: 'Boeing 787-9 Dreamliner', seats: 290, maxPayloadKG: 50000, price: 292.5 },
            { id: 'A350-900', model: 'Airbus A350-900', seats: 300, maxPayloadKG: 60000, price: 317.4 },
            { id: '747F', model: 'Boeing 747-400F (Cargo Only)', seats: 0, maxPayloadKG: 112760, price: 50.0 },
        ];

        let selectedAircraft = AIRCRAFT_DATA[3]; // Default to A350-900 (300 seats)

        /**
         * Safely displays a message to the user.
         */
        function showMessage(message, type = 'error') {
            const box = document.getElementById('messageBox');
            if (!box) return;

            box.className = 'mt-6 p-3 text-sm rounded-lg';
            box.classList.remove('hidden');

            if (type === 'error') {
                box.classList.add('text-red-700', 'bg-red-100');
            } else {
                box.classList.add('text-green-700', 'bg-green-100');
            }

            box.innerHTML = message;
            
            setTimeout(() => {
                box.classList.add('hidden');
            }, 8000);
        }

        /**
         * Selects an aircraft, updates max capacity display, and triggers calculation.
         */
        function selectAircraft(aircraftId) {
            const newSelection = AIRCRAFT_DATA.find(a => a.id === aircraftId);
            if (!newSelection) {
                showMessage(`Aircraft ID ${aircraftId} not found.`, 'error');
                return;
            }
            selectedAircraft = newSelection;
            document.getElementById('selectedPlaneName').textContent = selectedAircraft.model;
            document.getElementById('planeDropdown').classList.add('hidden');
            
            // Update max capacity display
            document.getElementById('maxCapacity').textContent = selectedAircraft.seats.toLocaleString();
            
            // If Cargo-only, clear seat inputs
            if (selectedAircraft.seats === 0) {
                document.getElementById('configFirst').value = 0;
                document.getElementById('configBusiness').value = 0;
                document.getElementById('configEconomy').value = 0;
                document.getElementById('configFirst').disabled = true;
                document.getElementById('configBusiness').disabled = true;
                document.getElementById('configEconomy').disabled = true;
            } else {
                document.getElementById('configFirst').disabled = false;
                document.getElementById('configBusiness').disabled = false;
                document.getElementById('configEconomy').disabled = false;
            }

            updateSeatSum(); // Also runs the main calculation
        }

        /**
         * Populates the aircraft selection dropdown.
         */
        function populateDropdown() {
            const dropdown = document.getElementById('planeDropdown');
            dropdown.innerHTML = '';

            AIRCRAFT_DATA.forEach(plane => {
                const item = document.createElement('div');
                item.className = 'px-4 py-2 cursor-pointer hover:bg-indigo-100 transition duration-100 text-sm text-gray-800';
                item.textContent = `${plane.model} (Max Seats: ${plane.seats})`;
                item.onclick = () => selectAircraft(plane.id);
                dropdown.appendChild(item);
            });
        }

        /**
         * Core logic to calculate the minimum number of aircraft needed.
         */
        function calculateAircraftNeeded() {
            // --- 1. GET INPUTS (Demand and Single-Plane Configuration) ---
            const demandF = parseFloat(document.getElementById('totalFirstClassDemand').value) || 0;
            const demandB = parseFloat(document.getElementById('totalBusinessClassDemand').value) || 0;
            const demandE = parseFloat(document.getElementById('totalEconomyClassDemand').value) || 0;
            const demandCargoT = parseFloat(document.getElementById('totalCargoDemand').value) || 0;

            // Single-plane seat configuration
            const configF = parseFloat(document.getElementById('configFirst').value) || 0;
            const configB = parseFloat(document.getElementById('configBusiness').value) || 0;
            const configE = parseFloat(document.getElementById('configEconomy').value) || 0;
            
            const totalConfigSeats = configF + configB + configE;
            const planeMaxSeats = selectedAircraft.seats;

            // --- 2. VALIDATION CHECKS ---
            
            if (totalConfigSeats > planeMaxSeats) {
                showMessage(`The configured seats (${totalConfigSeats}) exceed the selected aircraft's maximum capacity (${planeMaxSeats}). Please reduce the seat count.`, 'error');
                document.getElementById('aircraftNeeded').textContent = 'ERROR';
                document.getElementById('limitingFactor').textContent = 'Invalid Config';
                document.getElementById('breakdownOutput').innerHTML = '<p class="text-red-500">Configuration exceeds aircraft capacity.</p>';
                return;
            }
            
            if (planeMaxSeats === 0 && (configF > 0 || configB > 0 || configE > 0)) {
                 showMessage(`Selected aircraft (${selectedAircraft.model}) is Cargo-only and cannot carry any configured passenger seats.`, 'error');
                 // Don't error out, but set config seats to zero and proceed with cargo check
                 // For the UI, we already disabled inputs, so this is just a final check.
            }
            
            const totalRequiredPassengers = demandF + demandB + demandE;
            const totalCargoWeightKG = demandCargoT * WEIGHT_PER_CARGO_TON;
            
            // --- 3. CALCULATE WEIGHT OF ONE FULLY CONFIGURED AIRCRAFT ---
            // Calculate the total weight (Pax + Baggage) for a single, fully loaded configured aircraft
            const configuredPaxWeightKG = (configF * WEIGHT_PER_FIRST) + 
                                          (configB * WEIGHT_PER_BUSINESS) + 
                                          (configE * WEIGHT_PER_ECONOMY);
            
            // We assume the non-passenger payload (cargo capacity) of a single flight is the maximum payload
            // minus the weight taken up by the configured passengers.
            const availableCargoPayloadKG = selectedAircraft.maxPayloadKG - configuredPaxWeightKG;

            // --- 4. CALCULATE PLANES REQUIRED FOR EACH CONSTRAINT ---

            // A. Planes required by total passenger seats (Capacity Constraint)
            // Divide total demand passengers by the number of seats available in the configured plane.
            const planesNeededBySeats = (totalConfigSeats > 0) 
                ? Math.ceil(totalRequiredPassengers / totalConfigSeats) 
                : (totalRequiredPassengers > 0 ? Infinity : 0);

            // B. Planes required by total cargo demand (Payload Constraint)
            // Divide total cargo demand by the cargo capacity available in one configured plane.
            let planesNeededByPayload = 0;
            if (totalCargoWeightKG > 0) {
                if (availableCargoPayloadKG <= 0) {
                    // Cannot carry any cargo with this configuration
                    planesNeededByPayload = Infinity;
                } else {
                    planesNeededByPayload = Math.ceil(totalCargoWeightKG / availableCargoPayloadKG);
                }
            }


            // --- 5. DETERMINE FINAL FLEET SIZE AND LIMITING FACTOR ---
            
            // Max is taken from the three constraints: Passenger Demand, Cargo Demand, or minimum 1 if any demand exists
            const finalAircraftNeeded = Math.max(planesNeededBySeats, planesNeededByPayload, 
                (totalRequiredPassengers > 0 || demandCargoT > 0 ? 1 : 0));
            
            let limitingFactor;
            if (finalAircraftNeeded === 0) {
                limitingFactor = 'Zero Demand';
            } else if (planesNeededByPayload > planesNeededBySeats) {
                limitingFactor = `Cargo/Payload Constraint`;
            } else if (planesNeededBySeats > planesNeededByPayload) {
                limitingFactor = `Passenger Seat Constraint`;
            } else {
                limitingFactor = `Seats & Payload Equal`;
            }
            
            // --- 6. CALCULATE UTILIZATION (for the limiting factor plane count) ---
            
            // Total capacity of the fleet
            const totalFleetConfigSeats = finalAircraftNeeded * totalConfigSeats;
            const totalFleetAvailableCargoPayloadKG = finalAircraftNeeded * availableCargoPayloadKG;
            
            // Utilization
            const capacityUtilization = (totalFleetConfigSeats > 0) ? (totalRequiredPassengers / totalFleetConfigSeats) * 100 : 0;
            const payloadUtilization = (totalFleetAvailableCargoPayloadKG > 0) ? (totalCargoWeightKG / totalFleetAvailableCargoPayloadKG) * 100 : 0;
            

            // --- 7. UPDATE UI ---
            
            // Main Results
            document.getElementById('aircraftNeeded').textContent = finalAircraftNeeded.toLocaleString();
            document.getElementById('limitingFactor').textContent = limitingFactor;
            
            document.getElementById('utilizationSummary').textContent = 
                `${capacityUtilization.toFixed(1)}% / ${payloadUtilization.toFixed(1)}%`;
            
            // Detailed Breakdown
            const breakdownHtml = `
                <p><strong>Configured Seats (Per Plane):</strong> F:${configF}, B:${configB}, E:${configE} (Total: ${totalConfigSeats})</p>
                <p><strong>Configured Payload Usage (Per Plane):</strong> ${(configuredPaxWeightKG / 1000).toFixed(2)} T for Passengers</p>
                <p><strong>Available Cargo Payload (Per Plane):</strong> ${(availableCargoPayloadKG / 1000).toFixed(2)} T</p>
                <hr class="my-2 border-gray-300">
                <p class="text-indigo-600"><strong>Planes required by Passenger Demand:</strong> ${planesNeededBySeats.toFixed(2)} (Rounded Up: ${Math.ceil(planesNeededBySeats)})</p>
                <p class="text-indigo-600"><strong>Planes required by Cargo Demand:</strong> ${planesNeededByPayload.toFixed(2)} (Rounded Up: ${Math.ceil(planesNeededByPayload)})</p>
                <hr class="my-2 border-gray-300">
                <p class="font-bold">Total Seats in Fleet (${finalAircraftNeeded}x): ${totalFleetConfigSeats.toLocaleString()} configured seats</p>
                <p class="font-bold">Total Cargo Capacity in Fleet (${finalAircraftNeeded}x): ${(totalFleetAvailableCargoPayloadKG / 1000).toFixed(2)} Tons</p>
            `;
            document.getElementById('breakdownOutput').innerHTML = breakdownHtml;
            
        }

        /**
         * Updates the configured seat sum display and triggers calculation.
         */
        function updateSeatSum() {
            const configF = parseFloat(document.getElementById('configFirst').value) || 0;
            const configB = parseFloat(document.getElementById('configBusiness').value) || 0;
            const configE = parseFloat(document.getElementById('configEconomy').value) || 0;
            
            const currentSum = configF + configB + configE;
            const maxSeats = selectedAircraft.seats;
            const sumElement = document.getElementById('currentSeatSum');
            
            sumElement.textContent = currentSum.toLocaleString();
            
            if (currentSum > maxSeats) {
                sumElement.classList.remove('text-green-600');
                sumElement.classList.add('text-red-600');
            } else {
                sumElement.classList.remove('text-red-600');
                sumElement.classList.add('text-green-600');
            }
            
            calculateAircraftNeeded();
        }

        /**
         * Initializes event listeners and runs the initial calculation.
         */
        function init() {
            populateDropdown();
            selectAircraft(selectedAircraft.id); // Initial default selection

            // Input fields for total demand
            const demandInputs = [
                'totalFirstClassDemand', 'totalBusinessClassDemand', 'totalEconomyClassDemand', 'totalCargoDemand'
            ];
            
            // Input fields for single-plane configuration
            const configInputs = ['configFirst', 'configBusiness', 'configEconomy'];

            // Attach listeners to all demand inputs
            demandInputs.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('input', calculateAircraftNeeded);
                }
            });
            
            // Attach listeners to configuration inputs (updates sum and calculates fleet size)
            configInputs.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('input', updateSeatSum);
                }
            });

            // Handle dropdown toggle
            const planeSelectButton = document.getElementById('planeSelectButton');
            const planeDropdown = document.getElementById('planeDropdown');
            if (planeSelectButton && planeDropdown) {
                planeSelectButton.addEventListener('click', () => {
                    planeDropdown.classList.toggle('hidden');
                });
            }

            // Close dropdown when clicking outside
            document.addEventListener('click', (e) => {
                if (planeDropdown && !planeSelectButton.contains(e.target) && !planeDropdown.contains(e.target)) {
                    planeDropdown.classList.add('hidden');
                }
            });
            
            // Initial setup
            updateSeatSum(); 
        }

        // Wait for the entire page to load before running initialization code
        window.addEventListener('load', init);

    </script>
</body>
</html>