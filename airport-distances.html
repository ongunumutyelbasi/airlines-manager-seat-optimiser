<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Airlines Manager Dynamic Seat Planner</title>
    <link rel="icon" type="image/x-icon" href="/images/favicon.png">
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        /* Custom utility classes */
        .bg-grid-pattern {
            /* A dark background pattern for a tech/data look */
            background-color: #050508;
            background-image: linear-gradient(rgba(34, 211, 238, 0.05) 1px, transparent 1px), linear-gradient(90deg, rgba(34, 211, 238, 0.05) 1px, transparent 1px);
            background-size: 20px 20px;
        }

        .glow-text {
            text-shadow: 0 0 5px rgba(34, 211, 238, 0.5), 0 0 10px rgba(34, 211, 238, 0.2);
        }
        
        /* Custom styling for the list items in the dropdown */
        .list-item {
            padding: 0.5rem 1rem;
            cursor: pointer;
            transition: background-color 150ms ease-in-out;
            /* Ensure list items have text color for visibility */
            color: #e2e8f0; /* slate-200 */
        }
        .list-item:hover {
            background-color: #0d121a; /* Darker shade for hover */
            color: #22d3ee;
        }

        /* Input focus styling adjustments */
        .search-input:focus {
            border-color: #22d3ee !important;
            box-shadow: 0 0 0 3px rgba(34, 211, 238, 0.3) !important;
            outline: none;
        }
        
        /* Style the search input within the dropdown for consistency */
        #airport1Search, #airport2Search {
            color: #22d3ee; /* Neon color for input text */
            background-color: #050508; /* Darker background for the search bar */
        }
    </style>

    <script src="https://unpkg.com/lucide@latest"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;600;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="styles.css">

</head>

<body class="bg-[#050508] text-slate-300 min-h-screen selection:bg-cyan-500/20 selection:text-cyan-200 bg-grid-pattern relative overflow-x-hidden">

    <!-- Ambient Light Effect --><div class="fixed top-0 left-1/2 -translate-x-1/2 w-[700px] h-[350px] bg-cyan-900/5 rounded-full blur-[100px] -z-10 pointer-events-none"></div>

        <!-- Mobile Menu Overlay -->
    <div id="mobile-menu-overlay" class="fixed inset-0 bg-black/70 backdrop-blur-sm z-40 hidden opacity-0 lg:hidden"></div>

    <!-- Mobile Menu -->
    <nav id="mobile-menu" class="fixed top-0 right-0 h-full w-80 bg-[#0f1014]/95 backdrop-blur-md border-l border-cyan-500/20 shadow-[-10px_0_30px_-10px_rgba(0,0,0,0.6)] z-50 lg:hidden translate-x-full transition-transform duration-300">
        <div class="flex flex-col h-full">
            <!-- Mobile Menu Header -->
            <div class="flex items-center justify-between p-6 border-b border-white/10">
                <h2 class="text-xl font-bold text-cyan-400 uppercase tracking-wide">Menu</h2>
                <button id="mobile-menu-close" class="p-2 text-slate-400 hover:text-cyan-400 transition duration-200">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>
            
            <!-- Mobile Menu Links -->
            <ul class="flex flex-col p-6 space-y-4 text-base font-semibold">
                <li>
                    <a href="reverse-optimizer.html" class="block text-slate-400 hover:text-cyan-400 hover:border-l-2 hover:border-cyan-700 pl-4 py-3 transition duration-200">
                        SEAT PLANNER
                    </a>
                </li>
                <li>
                    <a href="reverse-optimizer.html" class="block text-slate-400 hover:text-cyan-400 hover:border-l-2 hover:border-cyan-700 pl-4 py-3 transition duration-200">
                        MULTI-AIRCRAFT SEAT PLANNER
                    </a>
                </li>
                <li>
                    <a href="index.html" class="block text-cyan-400 border-l-2 border-cyan-400 pl-4 py-3 transition duration-200">
                        AIRPORT DISTANCES
                    </a>
                </li>
            </ul>
            
            <!-- Mobile Menu Footer -->
            <div class="mt-auto p-6 border-t border-white/10">
                <p class="text-xs text-slate-600 uppercase tracking-widest">
                    Made by <a href="https://su-consultancy.com" target="_blank" rel="noopener noreferrer" class="text-cyan-500 hover:underline">Umut Yelbaşı</a>
                </p>
            </div>
        </div>
    </nav>

    <!-- Main Container --><div class="max-w-7xl mx-auto p-4 md:p-6">
        
        <header class="mb-6 flex items-center justify-between border-b border-white/10 pb-4">
            <div class="flex items-center gap-3">
                <div class="p-2.5 bg-cyan-950/20 border border-cyan-500/20 rounded-lg shadow-[0_0_10px_rgba(34,211,238,0.1)]">
                    <i data-lucide="plane" class="w-6 h-6 text-cyan-300"></i>
                </div>
                <div>
                    <h1 class="text-2xl md:text-3xl font-bold text-white tracking-wide glow-text uppercase">Seat Planner</h1>
                    <p class="text-slate-600 text-xs font-semibold tracking-widest uppercase hidden md:block">AM Tycoon // Configuration Assistant // Made by <a href="https://su-consultancy.com" target="_blank" rel="noopener noreferrer" class="hover:underline hover:text-cyan-500 hover:transition hover:duration-300">Umut Yelbaşı</a></p>
                </div>
            </div>

            <!-- Hamburger Button (Mobile Only) -->
            <button id="mobile-menu-button" class="lg:hidden p-2 text-cyan-400 hover:text-cyan-300 transition duration-200 hover:bg-cyan-950/20 rounded">
                <i data-lucide="menu" class="w-6 h-6"></i>
            </button>

            <!-- Desktop Navigation (Hidden on Mobile) -->
            <nav class="hidden lg:block pt-4 mt-2">
                <ul class="flex space-x-8 text-base font-semibold">
                    <li>
                        <!-- Placeholder Link: Reduced bottom padding for sleeker hover -->
                        <a href="index.html" class="text-slate-500 border-cyan-700 hover:text-cyan-400 hover:border-b-2 hover:border-cyan-700 pb-0.5 transition duration-200">
                            SEAT PLANNER
                        </a>
                    </li>
                    <li>
                        <!-- Placeholder Link: Reduced bottom padding for sleeker hover -->
                        <a href="reverse-optimizer.html" class="text-slate-500 border-cyan-700 hover:text-cyan-400 hover:border-b-2 hover:border-cyan-700 pb-0.5 transition duration-200">
                            MULTI-AIRCRAFT SEAT PLANNER
                        </a>
                    </li>
                    <li>
                        <!-- Active Link: Reduced bottom padding to pb-0.5 for a tighter border -->
                        <a href="#" class="text-cyan-400 border-b-2 border-cyan-400 pb-0.5 transition duration-200">
                            AIRPORT DISTANCES
                        </a>
                    </li>
                </ul>
            </nav>
        </header>

        <div id="loading" class="text-center p-8">
            <div class="flex justify-center items-center">
                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary mr-3"></div>
                <span class="text-gray-600">Loading airport data...</span>
            </div>
        </div>

        <form id="distanceForm" class="hidden space-y-6">
            
            <div class="space-y-6">
                <!-- Airport 1 Selection (Departure) -->
                <div class="relative">
                    <label class="block text-sm font-medium text-gray-400 mb-1">DEPARTURE TERMINAL</label>
                    <input 
                        type="text" 
                        id="airport1Input" 
                        placeholder="Search Airport Name or Code..." 
                        class="search-input w-full p-3 rounded-lg focus:border-neon focus:ring-neon transition duration-150 ease-in-out cursor-pointer"
                        data-airport-id=""
                        readonly
                    >
                    
                    <!-- Custom Dropdown Container 1 -->
                    <div 
                        id="airport1Dropdown" 
                        class="absolute z-50 left-0 right-0 mt-1 bg-[#1A1B21] border border-cyan-500/20 rounded-lg shadow-[0_10px_30px_-10px_rgba(0,0,0,0.6)] overflow-hidden"
                    >
                        <div class="p-2 border-b border-white/5 bg-[#1A1B21] sticky top-0">
                            <input 
                                type="text" 
                                id="airport1Search" 
                                placeholder="FILTER TERMINALS..." 
                                class="w-full bg-black/50 border border-white/10 rounded-lg px-3 py-1.5 text-sm text-cyan-200 placeholder-slate-600 focus:border-cyan-400 focus:outline-none tracking-wide"
                            >
                        </div>
                        <div id="airport1List" class="max-h-60 overflow-y-auto divide-y divide-white/5">
                            <!-- Options injected by JS -->
                        </div>
                    </div>
                </div>

                <!-- Airport 2 Selection (Arrival) -->
                <div class="relative">
                    <label class="block text-sm font-medium text-gray-400 mb-1">ARRIVAL TERMINAL</label>
                    <input 
                        type="text" 
                        id="airport2Input" 
                        placeholder="Search Airport Name or Code..." 
                        class="search-input w-full p-3 rounded-lg focus:border-neon focus:ring-neon transition duration-150 ease-in-out cursor-pointer"
                        data-airport-id=""
                        readonly
                    >

                    <!-- Custom Dropdown Container 2 -->
                    <div 
                        id="airport2Dropdown" 
                        class="absolute z-50 left-0 right-0 mt-1 bg-[#1A1B21] border border-cyan-500/20 rounded-lg shadow-[0_10px_30px_-10px_rgba(0,0,0,0.6)] hidden overflow-hidden"
                    >
                        <div class="p-2 border-b border-white/5 bg-[#1A1B21] sticky top-0">
                            <input 
                                type="text" 
                                id="airport2Search" 
                                placeholder="FILTER TERMINALS..." 
                                class="w-full bg-black/50 border border-white/10 rounded-lg px-3 py-1.5 text-sm text-cyan-200 placeholder-slate-600 focus:border-cyan-400 focus:outline-none tracking-wide"
                            >
                        </div>
                        <div id="airport2List" class="max-h-60 overflow-y-auto divide-y divide-white/5">
                            <!-- Options injected by JS -->
                        </div>
                    </div>
                </div>
            </div>

            <button type="submit" 
                    class="w-full py-3 bg-primary text-white font-semibold rounded-full hover:bg-primary-dark transition duration-150 ease-in-out shadow-md hover:shadow-lg">
                CALCULATE LINK DISTANCE
            </button>
        </form>

        <!-- Result Display -->
        <div id="resultContainer" class="mt-8 pt-6 border-t border-gray-700 hidden">
            <h3 class="text-lg font-semibold text-gray-400 mb-3">CALCULATED LINK</h3>
            
            <div id="result" class="bg-black/20 border-l-4 border-neon text-white p-4 rounded-lg shadow-inner">
                <p id="distanceOutput" class="text-3xl font-bold text-neon tracking-wider">0 km</p>
                <p id="routeOutput" class="text-sm text-gray-400 mt-2">Select two terminals above to initiate calculation.</p>
            </div>
            
            <p id="errorMsg" class="text-red-500 mt-4 hidden"></p>
        </div>
    </div>


    <!-- Firebase SDKs (Included for compliance, though not used for calculation) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // --- Firebase Initialization (Boilerplate) ---
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : { /* Mock Config */ };
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let db, auth, userId;
        try {
            const app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            auth = getAuth(app);
            
            (async () => {
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }
                userId = auth.currentUser?.uid || crypto.randomUUID();
            })();
        } catch (e) {
            console.error("Firebase initialization failed:", e);
        }
        
        // ---------------------------------------------
        // --- Data Loading and Structuring ---
        // ---------------------------------------------

        // This JSON object simulates the contents of your airports.json file.
        const AIRPORTS_JSON = {
           "00A": {
              "type": "heliport", "name": "Total RF Heliport", "iata_code": "00A", 
              "coordinates": "40.070985, -74.933689"
           },
           "00AA": {
              "type": "small_airport", "name": "Aero B Ranch Airport", "iata_code": "AEX", 
              "coordinates": "38.704022, -101.473911"
           },
           "00AK": {
              "type": "small_airport", "name": "Lowell Field", "iata_code": "LFL", 
              "coordinates": "60.013, -151.699989"
           },
           "KJFK": { 
               "type": "large_airport", "name": "John F Kennedy International Airport", "iata_code": "JFK",
               "coordinates": "40.63980103, -73.77890015"
           },
           "EGLL": { 
               "type": "large_airport", "name": "London Heathrow Airport", "iata_code": "LHR", 
               "coordinates": "51.4706, -0.461941"
           },
           "ZSPD": { 
               "type": "large_airport", "name": "Shanghai Pudong International Airport", "iata_code": "PVG", 
               "coordinates": "31.1434, 121.805"
           },
           "SAEZ": { 
               "type": "large_airport", "name": "Ministro Pistarini International Airport", "iata_code": "EZE", 
               "coordinates": "-34.8222, -58.5358"
           },
           "EGPW": {
              "type": "small_airport", "name": "Unst Airport", "iata_code": "UNT",
              "coordinates": "60.7472, -0.85385"
           },
           "AYGA": {
               "type": "medium_airport", "name": "Goroka Airport", "iata_code": "GKA",
               "coordinates": "-6.08206, 145.392003"
           },
           "EDDT": { 
               "type": "large_airport", "name": "Berlin Tegel Airport", "iata_code": "TXL", 
               "coordinates": "52.5597, 13.2877"
           },
           "WSSS": { 
               "type": "large_airport", "name": "Singapore Changi Airport", "iata_code": "SIN", 
               "coordinates": "1.35019, 103.994003"
           },
           "FAOR": { 
               "type": "large_airport", "name": "O.R. Tambo International Airport", "iata_code": "JNB", 
               "coordinates": "-26.1392, 28.246"
           },
        };

        let AIRPORT_DATA = []; // Array of processed airport objects
        let AIRPORT_MAP = {}; // Map for quick lookup {id: airport_object}

        /**
         * Cleans, parses, and formats the raw JSON into usable data structures.
         */
        function preprocessData(rawData) {
            const processed = [];
            for (const id in rawData) {
                const data = rawData[id];
                const coords = parseCoordinates(data.coordinates);
                
                if (coords && data.name) {
                    const displayCode = (data.iata_code || data.icao_code || id).toUpperCase();
                    const airport = {
                        id: id,
                        name: data.name,
                        code: displayCode,
                        display: `${data.name} (${displayCode})`,
                        lat: coords[0],
                        lon: coords[1],
                        searchText: `${data.name.toLowerCase()} ${displayCode.toLowerCase()}`
                    };
                    processed.push(airport);
                    AIRPORT_MAP[id] = airport;
                }
            }
            return processed;
        }

        // ---------------------------------------------
        // --- Core Distance Calculation Logic ---
        // ---------------------------------------------
        
        /**
         * Parses the string coordinates "lat, lon" into a number array [lat, lon].
         */
        function parseCoordinates(coordString) {
            if (!coordString) return null;
            const parts = coordString.split(',').map(s => s.trim());
            const lat = parseFloat(parts[0]);
            const lon = parseFloat(parts[1]);
            
            if (isNaN(lat) || isNaN(lon)) return null;
            return [lat, lon];
        }

        /**
         * Calculates the distance between two points on the Earth's surface.
         */
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371; // Radius of Earth in kilometers
            const dLat = (lat2 - lat1) * (Math.PI / 180);
            const dLon = (lon2 - lon1) * (Math.PI / 180);
            
            const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                      Math.cos(lat1 * (Math.PI / 180)) * Math.cos(lat2 * (Math.PI / 180)) *
                      Math.sin(dLon / 2) * Math.sin(dLon / 2);
            
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
            
            return R * c; // Distance in km
        }

        // ---------------------------------------------
        // --- UI Logic and Event Handling for Searchable Dropdowns ---
        // ---------------------------------------------
        
        const distanceForm = document.getElementById('distanceForm');
        const resultContainer = document.getElementById('resultContainer');
        const distanceOutput = document.getElementById('distanceOutput');
        const routeOutput = document.getElementById('routeOutput');
        const errorMsg = document.getElementById('errorMsg');
        const loading = document.getElementById('loading');

        // References for the first dropdown
        const input1 = document.getElementById('airport1Input');
        const search1 = document.getElementById('airport1Search');
        const list1 = document.getElementById('airport1List');
        const dropdown1 = document.getElementById('airport1Dropdown');

        // References for the second dropdown
        const input2 = document.getElementById('airport2Input');
        const search2 = document.getElementById('airport2Search');
        const list2 = document.getElementById('airport2List');
        const dropdown2 = document.getElementById('airport2Dropdown');
        
        // --- Dropdown Management Functions ---

        /**
         * Renders the list of airports into the dropdown container.
         * @param {Array} airports - Filtered array of airport objects.
         * @param {HTMLElement} listElement - The <div> to render the list items into.
         */
        function renderAirportList(airports, listElement) {
            listElement.innerHTML = '';
            const fragment = document.createDocumentFragment();

            if (airports.length === 0) {
                const noResult = document.createElement('div');
                noResult.className = 'list-item text-gray-500';
                noResult.textContent = 'No results found.';
                fragment.appendChild(noResult);
            } else {
                airports.forEach(airport => {
                    const item = document.createElement('div');
                    item.className = 'list-item text-sm text-white';
                    item.textContent = airport.display;
                    item.setAttribute('data-id', airport.id);
                    fragment.appendChild(item);
                });
            }
            listElement.appendChild(fragment);
        }

        /**
         * Sets up the interactive logic for a single searchable dropdown.
         * @param {HTMLElement} inputField - The main input display field.
         * @param {HTMLElement} searchInput - The input field used for filtering.
         * @param {HTMLElement} listContainer - The <div> containing the list items.
         * @param {HTMLElement} dropdownContainer - The floating <div> wrapper.
         */
        function setupSearchableDropdown(inputField, searchInput, listContainer, dropdownContainer) {
            
            // 1. Show the dropdown when the main input is clicked
            inputField.addEventListener('click', () => {
                // Hide the other dropdown first
                if (dropdownContainer === dropdown1) {
                    dropdown2.classList.add('hidden');
                } else {
                    dropdown1.classList.add('hidden');
                }

                // Show the current dropdown
                dropdownContainer.classList.remove('hidden');
                searchInput.value = '';
                searchInput.focus();
                renderAirportList(AIRPORT_DATA, listContainer);
            });

            // 2. Hide the dropdown when clicking outside
            document.addEventListener('click', (e) => {
                if (!dropdownContainer.contains(e.target) && e.target !== inputField) {
                    dropdownContainer.classList.add('hidden');
                }
            });

            // 3. Filtering logic
            searchInput.addEventListener('input', () => {
                const query = searchInput.value.toLowerCase();
                const filtered = AIRPORT_DATA.filter(airport => 
                    airport.searchText.includes(query)
                );
                renderAirportList(filtered, listContainer);
            });

            // 4. Selection logic
            listContainer.addEventListener('click', (e) => {
                const item = e.target.closest('.list-item');
                if (item && item.hasAttribute('data-id')) {
                    const id = item.getAttribute('data-id');
                    const airport = AIRPORT_MAP[id];

                    inputField.value = airport.display;
                    inputField.setAttribute('data-airport-id', id);

                    dropdownContainer.classList.add('hidden');
                }
            });
        }

        /**
         * Handles form submission and calculates the distance.
         */
        function handleCalculate(e) {
            e.preventDefault();
            errorMsg.classList.add('hidden');
            resultContainer.classList.remove('hidden');

            const id1 = input1.getAttribute('data-airport-id');
            const id2 = input2.getAttribute('data-airport-id');

            if (!id1 || !id2) {
                errorMsg.textContent = 'Error: Please select both a Departure and Arrival Terminal.';
                errorMsg.classList.remove('hidden');
                distanceOutput.textContent = '0 km';
                routeOutput.textContent = 'Calculation failed.';
                return;
            }

            if (id1 === id2) {
                distanceOutput.textContent = '0 km';
                routeOutput.textContent = 'The two selected terminals are the same.';
                return;
            }

            const airport1 = AIRPORT_MAP[id1];
            const airport2 = AIRPORT_MAP[id2];
            
            if (!airport1 || !airport2) {
                errorMsg.textContent = 'Error: Could not retrieve terminal coordinates.';
                errorMsg.classList.remove('hidden');
                return;
            }

            const distance = calculateDistance(
                airport1.lat, airport1.lon,
                airport2.lat, airport2.lon
            );

            // Display results
            distanceOutput.textContent = `${distance.toLocaleString(undefined, { maximumFractionDigits: 0 })} km`;
            routeOutput.textContent = `Link established: ${airport1.display} to ${airport2.display}`;
        }


        // --- Application Setup ---
        window.onload = () => {
            lucide.createIcons();
            
            // 1. Process data from the raw JSON
            AIRPORT_DATA = preprocessData(AIRPORTS_JSON);
            
            // 2. Set up the two searchable dropdowns
            if (AIRPORT_DATA.length > 0) {
                setupSearchableDropdown(input1, search1, list1, dropdown1);
                setupSearchableDropdown(input2, search2, list2, dropdown2);
                
                // 3. Show UI and hide loading
                distanceForm.classList.remove('hidden');
                resultContainer.classList.remove('hidden');
                loading.classList.add('hidden');
            } else {
                loading.innerHTML = '<p class="text-red-500">Error: No valid terminal data loaded.</p>';
                return;
            }
            
            // 4. Attach form event listener
            distanceForm.addEventListener('submit', handleCalculate);
        };
        
    </script>
</body>
</html>